@inject Microsoft.Extensions.Localization.IStringLocalizer<Index> L@page "/payment/{transactionId}"@using System.Globalization;@using Model.Concrete;@using Newtonsoft.Json;@using System.Net.Http.Headers;@using System.Security.Cryptography;@using System.Text;<PageTitle>Payment</PageTitle><main data-parameter="@transactionId">    <!-- =======================    Page Banner START -->    <section class="py-0">        <div class="container">            <div class="row mt-4 align-items-center">                <div class="col-12">                    <!-- Card START -->                    <div class="card bg-light overflow-hidden px-sm-5">                        <div class="row align-items-center g-4">                            <!-- Content -->                            <div class="col-sm-9">                                <div class="card-body">                                    <!-- Breadcrumb -->                                    <nav aria-label="breadcrumb">                                        <ol class="breadcrumb breadcrumb-dots mb-0">                                            <li class="breadcrumb-item"><a href="index.html"><i class="bi bi-house me-1"></i> Home</a></li>                                            <li class="breadcrumb-item">Hotel detail</li>                                            <li class="breadcrumb-item active">Booking</li>                                        </ol>                                    </nav>                                    <!-- Title -->                                    <h1 class="m-0 h2 card-title">Payment</h1>                                </div>                            </div>                            <!-- Image -->                            <div class="col-sm-3 text-end d-none d-sm-block">                                <img src="assets/images/element/17.svg" class="mb-n4" alt="">                            </div>                        </div>                    </div>                    <!-- Card END -->                </div>            </div>        </div>    </section>    <!-- =======================    Page Banner END -->    <!-- =======================    Steps START -->    <section>        <div class="container">            <div id="stepper" class="bs-stepper stepper-outline">                <!-- Step Buttons START -->                <!-- Step Buttons END -->                <!-- Step content START -->                <div class="bs-stepper-content p-0 pt-4">                    <div class="row g-4">                        <!-- Main content START -->                        <div class="col-xl-8">                                                           <div id="step-3" role="tabpanel" class="content " aria-labelledby="steppertrigger3" data-parameter="@transactionId">                                    <div class="vstack gap-4">                                        <!-- Title -->                                        <h4 class="mb-0">Payment options</h4>                                        <hr class="my-0"> <!-- Divider -->                                        <!-- Credit or Debit Card START -->                                        <div class="card border">                                            <!-- Card header -->                                            <div class="card-header border-bottom d-sm-flex justify-content-between align-items-center">                                                <h5 class="mb-2 mb-sm-0">Credit or Debit Card</h5>                                                <ul class="list-inline my-0">                                                    <li class="list-inline-item"> <a href="#"><img src="assets/images/element/visa.svg" class="h-30px" alt=""></a></li>                                                    <li class="list-inline-item"> <a href="#"><img src="assets/images/element/mastercard.svg" class="h-30px" alt=""></a></li>                                                    <li class="list-inline-item"> <a href="#"><img src="assets/images/element/expresscard.svg" class="h-30px" alt=""></a></li>                                                </ul>                                            </div>                                            <!-- Card body -->                                            <div class="card-body">                                                <div class="row g-4">                                                      <!-- Card holder name -->                                                    <div class="col-6">                                                        <label class="form-label">Name</label>                                                        <div class="form-control-bg-light">                                                            <input required type="text" value="Gokhan"  class="form-control Name">                                                        </div>                                                    </div>                                                <div class="col-6">                                                    <label class="form-label">Surname</label>                                                    <div class="form-control-bg-light">                                                        <input required type="text" value="Sahinbas"  class="form-control Surname">                                                    </div>                                                </div>                                                    <!-- Card number -->                                                    <div class="col-12">                                                        <label class="form-label">Card Number</label>                                                        <div class="position-relative form-control-bg-light">                                                        <input required type="text" class="form-control CardNo" data-mask="CreditCard" value="5406-6975-4321-1173" name="CardNumber" maxlength="19" placeholder="XXXX-XXXX-XXXX-XXXX">                                                            <img src="assets/images/element/visa.svg" class="w-30px position-absolute top-50 end-0 translate-middle-y me-2 d-none d-sm-block" alt="">                                                        </div>                                                    </div>                                                    <!-- Expiration Month -->                                                    <div class="col-md-4">                                                        <label class="form-label">Expiration Month</label>                                                        <div class="form-control-bg-light">                                                        <input required type="text" class="form-control ExpiryMonth" value="03" maxlength="2" placeholder="XX">                                                        </div>                                                    </div>                                                    <!-- Expiration Year -->                                                    <div class="col-md-4">                                                        <label class="form-label">Expiration Year</label>                                                        <div class="form-control-bg-light">                                                        <input required type="text" class="form-control ExpiryYear" value="2023" maxlength="4" placeholder="XXXX">                                                        </div>                                                    </div>                                                    <!-- Cvv/CVC -->                                                    <div class="col-md-4">                                                        <label class="form-label">CVV / CVC</label>                                                        <div class="form-control-bg-light">                                                        <input required type="text" class="form-control CvvNo" value="465" maxlength="3" placeholder="XXX">                                                        </div>                                                    </div>                                                                                                  </div>                                            </div>                                        </div>                                        <!-- Credit or Debit Card END -->                                                                              <!-- Step 3 button -->                                        <div class="d-flex justify-content-between">                                            <input type="button" class="btn btn-secondary prev-btn mb-0" value="Previous">                                            <a data-href="/thankyou/@transactionId" class="btn btn-success next-btn mb-0 payNow" >Pay now</a>                                                                                   </div>                                    </div>                                </div>                                                    </div>                        <!-- Main content END -->                        <!-- Right sidebar START -->                        <aside class="col-xl-4">                            <div class="vstack gap-4">                                <!-- Price summary START -->                                <div class="card border">                                    <!-- card header -->                                    <div class="card-header border-bottom">                                        <h5 class="card-title mb-0">Price Summary</h5>                                    </div>                                    <div class="card-body">                                        <!-- Card list START -->                                        @foreach (var item in BookingReservations)
                                        {
                                            if (item.JsonData != null && item.JsonData != "" && item.JsonData.Contains("hotelDetail"))
                                            {
                                                var deserializeItem = JsonConvert.DeserializeObject<List<ZarenUI.Services.Models.Reservation.ReservationDetail>>(item.JsonData);
                                                if (deserializeItem != null)
                                                {
                                                    var i = 0;
                                                    foreach (var itemDeserialize in deserializeItem)
                                                    {
                                                        totalPriceValue += itemDeserialize.Price.Amount;                                                        <div class="card  border p-3 mb-3 removeBasket@(item.Id)">                                                            <a href="#" data-id="@item.Id" class="btn  removeBasket"><i class="bi bi-trash3-fill"></i></a>                                                            <div class="row align-items-center">                                                                <!-- Image -->                                                                <!-- Card Body -->                                                                <div class="col-sm-12 col-md-12">                                                                    <div class="card-body pt-3 pt-sm-0 p-0">                                                                        <!-- Title -->                                                                        <h5 class="card-title"><a href="#">@itemDeserialize.Name</a></h5>                                                                    </div>                                                                </div>                                                            </div><div class="row g-4">                                                                <!-- Item -->                                                                <div class="col-lg-6">                                                                    <div class="">                                                                        <h6 class="fw-light small mb-1">Check-in</h6>                                                                        <h5 class="mb-1">@itemDeserialize.BeginDate.ToShortDateTime("dd.MM.yyyy")</h5>                                                                    </div>                                                                </div>                                                                <!-- Item -->                                                                <div class="col-lg-6">                                                                    <div class="">                                                                        <h6 class="fw-light small mb-1">Check out</h6>                                                                        <h5 class="mb-1">@itemDeserialize.EndDate.ToShortDateTime("dd.MM.yyyy")</h5>                                                                    </div>                                                                </div>                                                                @{                                                                    CultureInfo provider = CultureInfo.InvariantCulture;
                                                                    DateTime datecheckIn = DateTime.ParseExact(itemDeserialize.BeginDate.ToString("dd.MM.yyyy"), "dd.MM.yyyy", provider);
                                                                    DateTime datecheckOut = DateTime.ParseExact(itemDeserialize.EndDate.ToString("dd.MM.yyyy"), "dd.MM.yyyy", provider);

                                                                    var diffOfDates = datecheckOut.Subtract(datecheckIn);                                                                }                                                                <!-- Item -->                                                                <div class="col-lg-12">                                                                    <div class="bg-light py-3 px-4 rounded-3">                                                                        <h5 class="mb-1">@(itemDeserialize.Adult + itemDeserialize.Child) Guests</h5>                                                                        <small><i class="bi bi-brightness-high me-1"></i>@(diffOfDates.Days) Nights - @(diffOfDates.Days + 1) Days</small>                                                                    </div>                                                                </div>                                                                <div class="col-lg-12">                                                                    <div class="bg-light py-3 px-4 rounded-3">                                                                        <h5 class="mb-1">@(itemDeserialize.Price.Amount.ToMoneyString() + " " + itemDeserialize.Price.Currency)</h5>                                                                    </div>                                                                </div>                                                            </div>                                                        </div>                                                        if ((deserializeItem.Count - 1) == i)
                                                        {
                                                            totalPrice = totalPriceValue.ToMoneyString() + " " + itemDeserialize.Price.Currency;
                                                        }
                                                        i++;
                                                    }

                                                }
                                            }


                                        }                                        <!-- Card list END -->                                        <!-- Information START -->                                        <!-- Information END -->                                        <!-- Card START -->                                        <!-- Card END -->                                    </div>                                    <!-- Card body -->                                    <!-- Card footer -->                                    @if (totalPrice != "")
                                    {                                        <div class="card-footer border-top">                                            <div class="d-flex justify-content-between align-items-center">                                                <span class="h5 mb-0">Payable Now</span>                                                <span class="h5 mb-0">@totalPrice</span>                                            </div>                                        </div>                                    }                                </div>                                <!-- Price summary END -->                                <!-- Book online START -->                                <!-- Book online END -->                            </div> <!-- Row END -->                        </aside>                        <!-- Right sidebar END -->                    </div>                </div>                <!-- Step content END -->            </div>        </div>    </section>    <!-- =======================    Steps END --></main>@code {    [ParameterAttribute]
    public string transactionId { get; set; }    public string totalPrice { get; set; }
    public double totalPriceValue { get; set; }
    [ParameterAttribute]
    public string language { get; set; }
    public List<BookingReservations> BookingReservations { get; set; }
    [Inject]
    public PaymentRequestModel paymentRequestModel { get; set; } 
    [Inject]
    protected TokenHelper _tokenHelper { get; set; }
    [Inject]
    protected NavigationManager NavigationManager { get; set; }
  
    [Inject]
    protected BookingReservationsRepository bookingReservationsRepository { get; set; }
     
    protected override async Task OnInitializedAsync()
    {
       // var GetPaymentOptions = _tokenHelper.GetPaymentOptions(transactionId).ToJson();
        BookingReservations = _tokenHelper.GetBasket().OrderByDescending(a => a.CreatedDate).Take(1).ToList();
        if (!BookingReservations.Any())
        
            NavigationManager.NavigateTo("/");             
        await base.OnInitializedAsync(); 
    }
  }