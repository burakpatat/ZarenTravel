@page "/booking-reservations"@attribute [Authorize]@inject IJSRuntime JSRuntime@inject NavigationManager NavigationManager@inject DialogService DialogService@inject ContextMenuService ContextMenuService@inject TooltipService TooltipService@inject NotificationService NotificationService@inject ZarenService ZarenService@inject Microsoft.Extensions.Localization.IStringLocalizer<BookingReservations> L@using Newtonsoft.Json;@using System.Globalization;@using ZarenBO2.Models.Zaren;<PageTitle>BookingReservations</PageTitle><RadzenRow Gap="5" RowGap="5">    <RadzenColumn Size="12">        <div class="col-12 mb-5">            <div class="d-sm-flex justify-content-between align-items-center">                <h1 class="h3 mb-2 mb-sm-0">Booking</h1>                <div class="d-grid"><a href="#" class="btn btn-primary-soft mb-0"><i class="bi bi-plus-lg fa-fw"></i> Add New Room</a></div>            </div>        </div>        <div class="row g-4 mb-5">            <div class="col-md-6 col-xxl-3">                <div class="card card-body shadow p-4">                    <div class="d-flex justify-content-between align-items-center mb-3">                        <div class="me-2">                            <span>New Booked Rooms</span>                            <h3 class="mb-0 mt-2">54</h3>                        </div>                        <div class="icon-lg rounded-circle flex-shrink-0 bg-primary bg-opacity-10 text-primary mb-0"><i class="bi bi-door-open fa-fw"></i></div>                    </div>                    <div class="progress progress-xs bg-primary bg-opacity-10 mb-2"><div class="progress-bar bg-primary" role="progressbar" style="width: 60%" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div></div>                    <span><span class="text-primary">16 new rooms booked</span> today</span>                </div>            </div>            <div class="col-md-6 col-xxl-3">                <div class="card card-body shadow p-4">                    <div class="d-flex justify-content-between align-items-center mb-3">                        <div class="me-2">                            <span>Cancelled Rooms</span>                            <h3 class="mb-0 mt-2">12</h3>                        </div>                        <div class="icon-lg rounded-circle flex-shrink-0 bg-danger bg-opacity-10 text-danger mb-0"><i class="bi bi-x-circle fa-fw"></i></div>                    </div>                    <div class="progress progress-xs bg-danger bg-opacity-10 mb-2"><div class="progress-bar bg-danger" role="progressbar" style="width: 60%" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div></div>                    <span><span class="text-danger">2 canceled rooms</span> today</span>                </div>            </div>            <div class="col-md-6 col-xxl-3">                <div class="card card-body shadow p-4">                    <div class="d-flex justify-content-between align-items-center mb-3">                        <div class="me-2">                            <span>Check-in</span>                            <h3 class="mb-0 mt-2">20</h3>                        </div>                        <div class="icon-lg rounded-circle flex-shrink-0 bg-success bg-opacity-10 text-success mb-0"><i class="bi bi-box-arrow-in-right fa-fw"></i></div>                    </div>                    <div class="progress progress-xs bg-success bg-opacity-10 mb-2"><div class="progress-bar bg-success" role="progressbar" style="width: 60%" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div></div>                    <span><span class="text-success">45 reservation</span> incoming</span>                </div>            </div>            <div class="col-md-6 col-xxl-3">                <div class="card card-body shadow p-4">                    <div class="d-flex justify-content-between align-items-center mb-3">                        <div class="me-2">                            <span>Check-out</span>                            <h3 class="mb-0 mt-2">28</h3>                        </div>                        <div class="icon-lg rounded-circle flex-shrink-0 bg-orange bg-opacity-10 text-orange mb-0"><i class="bi bi-box-arrow-right fa-fw"></i></div>                    </div>                    <div class="progress progress-xs bg-orange bg-opacity-10 mb-2"><div class="progress-bar bg-orange" role="progressbar" style="width: 60%" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div></div>                    <span><span class="text-orange">30 reservation</span> outgoing</span>                </div>            </div>        </div>        <div class="row g-4 justify-content-between align-items-center">            <div class="col-lg-5">                <ul class="nav nav-pills-shadow nav-responsive" role="tablist">                    <li class="nav-item" role="presentation"><a class="nav-link mb-0 me-sm-2 active" data-bs-toggle="tab" href="#tab-1" aria-selected="true" role="tab">All Status</a></li>                    <li class="nav-item" role="presentation"><a class="nav-link mb-0 me-sm-2" data-bs-toggle="tab" href="#tab-2" aria-selected="false" tabindex="-1" role="tab">Available</a></li>                    <li class="nav-item" role="presentation"><a class="nav-link mb-0" data-bs-toggle="tab" href="#tab-3" aria-selected="false" tabindex="-1" role="tab">Sold Out</a></li>                </ul>            </div>            <div class="col-lg-6 col-xxl-5">                <div class="d-sm-flex gap-4 justify-content-between justify-content-lg-end">                    <div class="col-md-8">                        <form class="rounded position-relative">                            <input class="form-control bg-transparent" type="search" placeholder="Search" aria-label="Search">                            <button class="bg-transparent p-2 position-absolute top-50 end-0 translate-middle-y border-0 text-primary-hover text-reset" type="submit"><i class="fas fa-search fs-6"></i></button>                        </form>                    </div>                    <div class="d-flex justify-content-end mt-2 mt-sm-0">                        <ul class="nav nav-pills nav-pills-dark" id="room-pills-tab" role="tablist">                            <li class="nav-item" role="presentation"><button class="nav-link rounded-start rounded-0 " id="grid-tab" data-bs-toggle="tab" data-bs-target="#grid-tab-pane" type="button" role="tab" aria-controls="grid-tab-pane" aria-selected="true"><i class="bi fa-fw bi-grid-fill" tabindex="-1"></i></button></li>                            <li class="nav-item" role="presentation"><button class="nav-link rounded-end rounded-0 active" id="list-tab" data-bs-toggle="tab" data-bs-target="#list-tab-pane" type="button" role="tab" aria-controls="list-tab-pane" aria-selected="false"><i class="bi fa-fw bi-list-ul"></i></button></li>                        </ul>                    </div>                </div>            </div>        </div>        <div class="tab-content mt-5" id="myTabContent">            <div class="tab-pane fade " id="grid-tab-pane" role="tabpanel" aria-labelledby="#grid-tab">                <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-xxl-5 g-4">                    @foreach (var item in BookingReservation)                    {
                        if (item.JsonData != null && item.JsonData != "" && item.JsonData.Contains("hotelDetail"))
                        {
                            var deserializeItem = JsonConvert.DeserializeObject<List<ZarenBO2.Models.ReservationDetail>>(item.JsonData);
                            if (deserializeItem != null)
                            {
                                foreach (var itemDeserialize in deserializeItem)
                                {                                    <div class="col">                                        <div class="card shadow h-100">                                            <div class="position-relative">                                                <!-- Image -->                                                <img src="assets/images/category/hotel/4by3/02.jpg" class="card-img-top" alt="Card image">                                                <!-- Overlay -->                                                <div class="card-img-overlay d-flex flex-column p-3">                                                    <!-- Card overlay top -->                                                    <div class="d-flex justify-content-between align-items-center">                                                        <div class=""><i class=""></i></div>                                                        <!-- Buttons -->                                                        <div class="list-inline-item dropdown">                                                            <!-- Dropdown button -->                                                            <a href="#" class="btn btn-sm btn-round btn-light" role="button" id="dropdownAction1" data-bs-toggle="dropdown" aria-expanded="false">                                                                <i class="bi bi-three-dots-vertical"></i>                                                            </a>                                                            <!-- dropdown items -->                                                            <ul class="dropdown-menu dropdown-menu-end min-w-auto shadow rounded small" aria-labelledby="dropdownAction1">                                                                <li><a class="dropdown-item" href="#"><i class="bi bi-trash me-2"></i>Delete</a></li>                                                                <li><a class="dropdown-item" href="#"><i class="bi bi-dash-circle me-2"></i>Change</a></li>                                                                <li><a class="dropdown-item" href="#"><i class="bi bi-view-list me-2"></i>View on Site</a></li>                                                            </ul>                                                        </div>                                                    </div>                                                </div>                                            </div>                                            <div class="card-body px-3">                                                <h5 class="card-title mb-1"><a href="admin-booking-detail.html">@itemDeserialize.Name</a></h5>                                                <ul class="list-group list-group-borderless small mt-2 mb-0">                                                    <li class="list-group-item pb-0">                                                        <i class="fa-solid fa-building fa-fw me-2"></i>Ground Floor: G5                                                    </li>                                                    <li class="list-group-item pb-0">                                                        <i class="fa-solid fa-bed fa-fw me-2"></i>Double Bed                                                    </li>                                                </ul>                                            </div>                                            <div class="card-footer pt-0">                                                <div class="hstack gap-2 mb-2">                                                    <h6 class="fw-normal mb-0">@(itemDeserialize.Price.Amount.ToMoneyString() + " " + @itemDeserialize.Price.Currency)</h6>                                                </div>                                                <a href="admin-booking-detail.html" class="btn btn-sm btn-primary-soft mb-0 w-100">View detail</a>                                            </div>                                        </div>                                    </div>                                }
                            }
                        }                    }                </div>            </div>            <div class="tab-pane fade show active" id="list-tab-pane" role="tabpanel" aria-labelledby="#list-tab">                <div class="card shadow">                    <div class="card-body">                        <div class="bg-light rounded p-3 d-none d-xxl-block">                            <div class="row row-cols-8 g-4">                                <!-- modified to have 8 columns -->                                <div class="col"><strong>Reservation No</strong></div>                                <div class="col"><strong>Hotel</strong></div>                                <div class="col"><strong>Travelers</strong></div>                                <div class="col"><strong>Price</strong></div>                                <div class="col"><strong>Check-in/out</strong></div>                                <div class="col"><strong>Paid</strong></div>                                <div class="col"><strong>Note</strong></div>                                <div class="col"><strong>Action</strong></div> <!-- modified to be in a separate column -->                            </div>                        </div>                        @foreach (var item in BookingReservation)
                        {                            if (item.JsonData != null && item.JsonData != "" && item.JsonData.Contains("hotelDetail"))                            {
                                var deserializeItem = JsonConvert.DeserializeObject<List<ZarenBO2.Models.ReservationDetail>>(item.JsonData);
                                if (deserializeItem != null)
                                {
                                    foreach (var itemDeserialize in deserializeItem)
                                    {                                        <div class="row row-cols-8 g-2 g-sm-4 align-items-md-center border-bottom px-2 py-2">                                            <!-- modified to have 8 columns -->                                            <div class="col">                                                <small class="d-block d-xxl-none">Reservation Number</small>                                                <span class="badge bg-danger"> @item.ReservationNumber</span>                                            </div>                                            <div class="col">                                                @itemDeserialize.Name                                            </div>                                            <div class="col">                                                <label id="guests">                                                    @(itemDeserialize.Adult + itemDeserialize.Child) Guests                                                    @foreach (var traveler in BookingTravellersList)                                                    {
                                                        if (item.ReservationNumber == traveler.ReservationNumber)

                                                        {                                                            <label class="form-control" value="@traveler.FirstName" disable data-i18="traveller.select.gender">@(traveler.FirstName + " " + traveler.LastName)</label>                                                        }                                                    }                                                </label>                                            </div>                                            <div class="col">                                                <small class="d-block d-xxl-none">Price:</small>                                                @(itemDeserialize.Price.Amount + " " + @itemDeserialize.Price.Currency)                                            </div>                                            <div class="col">                                                <small class="d-block d-xxl-none">Check-in&Check-out</small>                                                <div>@itemDeserialize.BeginDate.ToShortDateTime("dd.MM.yyyy")</div>                                                <div>@itemDeserialize.EndDate.ToShortDateTime("dd.MM.yyyy")</div>                                            </div>                                            <div class="col">                                                <small class="d-block d-xxl-none">Paid</small>                                                @{                                                    MarkupString markupString = new MarkupString(@item.HasPaid.ToYesNo());                                                }                                                @markupString                                            </div>                                            <div class="col">                                                <small class="d-block d-xxl-none">Note</small>                                                @item.Note                                            </div>                                            <div class="col">                                                <a href="booking-reservations/@item.Id" class="btn btn-sm btn-light mb-0">View</a>                                            </div>                                        </div>                                    }
                                }                            }
                        }                    </div>                </div>            </div>        </div>    </RadzenColumn></RadzenRow>@code {    public List<Model.Concrete.BookingTravellers> BookingTravellersList { get; set; } = new List<Model.Concrete.BookingTravellers>();


    public string guest;

    [Parameter]
    public string Email { get; set; }
    [Parameter]
    public string transactionId { get; set; }

    List<Model.Concrete.BookingReservations> BookingReservation { get; set; }

    [Inject]
    protected BookingTravellersRepository BookingTravellersRepository { get; set; }
    [Inject]
    protected BookingReservationsRepository bookingReservationsRepository { get; set; }


    protected override async Task OnInitializedAsync()
    {


        BookingReservation = bookingReservationsRepository.GetAll().Where(a => a.ReservationNumber != null).ToList();



        BookingTravellersList = BookingTravellersRepository.GetAll().Where(a => a.TransactionId != null).ToList();


    }}